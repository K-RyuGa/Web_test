
# 日本語学習支援AIゲームにおけるプロンプトエンジニアリングを通じた対話システムの高度化

**発表者**: (ご自身の氏名)
**所属**: (ご自身の所属)
**日付**: 2025年7月17日

---

## 1. はじめに

### 1.1. 研究背景
本研究では、外国人日本語学習者が、リアルな状況設定の中で実践的な会話能力を養うことを目的としたAI対話ゲームを開発している。AIが会話相手となることで、学習者は失敗を恐れずに、いつでも能動的な練習を行うことが可能となる。

### 1.2. 従来システムの課題
しかし、初期バージョンのシステムには、以下の3つの主要な課題が存在した。

1.  **AIの過度な受容性**: AIがプレイヤーの不自然・不適切な発言を許容しすぎてしまい、現実的な会話練習として機能しない場面があった。
2.  **不適切なパーソナライズ**: プレイヤーの行動履歴から「性格」や「気分」といった言語学習に無関係な特徴を抽出し、学習効果の低い、的はずれなパーソナライズを行っていた。
3.  **評価基準の曖昧さ**: 会話の評価がAIの裁量に委ねられ、明確な基準がないため、点数やフィードバックの一貫性・客観性に欠けていた。

### 1.3. 本発表の目的
上記の課題を解決するため、AIエージェント群に対して大規模なプロンプトエンジニアリングを実施した。本発表では、その**プロンプトの具体的な変更履歴**と、それによって実現された**新しいゲームシステムの詳細なフロー**について報告する。

---

## 2. プロンプトの改善履歴と設計思想

### 2.1. 会話エージェントの役割再定義（`base_prompt`の改善）

*   **課題**: AIが単なる親切な案内役になっており、プレイヤーが会話のステップを無視したり、TPOに合わない言葉を使ったりしても、ミッションが達成できてしまっていた。
*   **改善**: AIの役割を「親切な案内役」から「**リアルな会話をシミュレートするゲートキーパー**」へと再定義した。
*   **新プロンプトの要点**:
    *   TPOに反する言動や、会話の段階を無視した要求（例：初対面でいきなり連絡先を聞くなど）に対して、**安易に同意しない**よう厳命。
    *   拒否する際は、キャラクターとして自然な反応（困惑、丁寧な拒絶、意図の確認など）を返すよう指示。これにより、プレイヤーは「なぜダメだったのか」を自然な対話の中で学べる。

### 2.2. パーソナライズ機能の精度向上（`summary_prompt`と`make_new_prompt`の連携強化）

*   **課題**: `summary_prompt`がプレイヤーの性格を要約し、`make_new_prompt`がそれを基に不適切なシナリオを生成していた。
*   **改善**: 2つのプロンプトの役割を以下のように完全に分離・特化させた。

    *   **`summary_prompt`（行動履歴要約 → 言語的課題分析）**:
        *   役割を「プレイヤーの性格や特徴の要約」から「**言語的・コミュニケーション戦略的な課題の客観的抽出**」に限定。
        *   性格や意図の分析を固く禁止し、「文法・語彙」「敬語」「コミュニケーション戦略」などの観点から、具体的な課題のみを箇条書きで出力するように指示。

    *   **`make_new_prompt`（動的プロンプト生成）**:
        *   上記で生成された「**課題リスト**」をインプットとして受け取る。
        *   その課題をプレイヤーが**自然に克服せざるを得ないような会話状況**を、ベースシナリオに組み込むことをタスクとして明確化。
        *   （例：「助詞『が』の誤り」という課題に対し、「主語を明確にしないと意味が通じない質問をAIにさせる」など）

### 2.3. 評価システムの客観化（`evaluation_prompt`の改善）

*   **課題**: 「点数は厳しく」という曖昧な指示しかなく、評価点とフィードバック内容に一貫性がなかった。
*   **改善**: **明確な採点基準（ルーブリック）**を導入し、評価プロセスを構造化した。
*   **新プロンプトの要点**:
    *   「素晴らしい（90-100点）」から「大きな課題あり（0-39点）」までの4段階の評価レベルを定義。
    *   各レベルに「文法・語彙」「TPO」「会話の流れ」の観点から具体的な状態を記述。
    *   フィードバックの形式を「1. 点数」「2. 総評」「3. 詳細（良かった点・改善できる点）」に統一し、AIの裁量の幅をなくした。

---

## 3. ゲームシステムの詳細フロー

以上のプロンプト改善により、本ゲームのシステムは以下のフローで動作する。特に、**評価・要約プロセスが次回の動的プロンプト生成に直接影響を与える、自己改善型のループ**が構築された点が特徴である。

```mermaid
graph TD
    subgraph "事前準備"
        A[ユーザーがログインし、チャプターを選択]
    end

    subgraph "1. 動的プロンプト生成フェーズ"
        B(Google Sheetsから過去の課題リスト`player_summary`を読み込み)
        C{課題リストは存在するか？}
        B --> C
        
        C -- Yes --> D[GPT-4o: `make_new_prompt`実行]
        C -- No --> E[基本プロンプトを使用]
        
        A --> D
        A --> E

        D --> F[パーソナライズされたシステムプロンプトが完成]
        E --> F
    end

    subgraph "2. 会話実行フェーズ"
        G[AIが完成したプロンプトに基づき、会話を開始]
        F --> G
        
        G <--> H{プレイヤーとの対話ループ}
        
        H -- "ミッション達成"を検知 --> I[会話終了]
    end

    subgraph "3. 評価・要約フェーズ（会話終了後）"
        I --> J(会話履歴を分析対象とする)
        
        J --> K[GPT-4o: `evaluation_prompt`実行]
        J --> L[GPT-4o: `summary_prompt`実行]

        K --> M[評価点とフィードバックを生成]
        L --> N[**新しい課題リスト** (`player_summary`) を生成]

        M --> O[評価結果を画面に表示し、Sheetsに保存]
        N --> P[**新しい課題リストをSheetsに上書き保存**]
    end

    subgraph "4. 次のサイクルへ"
        Q[ユーザーが次のチャプターを選択]
        P --> Q
        O --> Q
    end

    style B fill:#f9f,stroke:#333,stroke-width:2px
    style N fill:#f9f,stroke:#333,stroke-width:2px
    style P fill:#f9f,stroke:#333,stroke-width:4px
```

### フローの解説
1.  **動的プロンプト生成**: プレイヤーがチャプターを選択すると、まずGoogle Sheetsに保存されている前回の「課題リスト(`player_summary`)」を読み込みます。これを基に`make_new_prompt`が今回の会話シナリオをパーソナライズします。
2.  **会話実行**: 生成されたシナリオに基づき、AIとの会話がスタートします。この際、AIは`base_prompt`の新しい原則に従い、リアルなゲートキーパーとして振る舞います。
3.  **評価・要約**: 会話が終了すると、その会話履歴が**並列的に**2つのAIエージェントに渡されます。
    *   一方は`evaluation_prompt`に基づき、プレイヤー向けの**評価**を生成します。
    *   もう一方は`summary_prompt`に基づき、**次回のパーソナライズに使うための新しい「課題リスト」**を生成し、Google Sheetsの古いデータを上書きします。
4.  **ループの完成**: このようにして、1回のプレイ結果（特に失敗や課題）が、次回の学習内容をより最適なものへと進化させるためのデータとして活用されるループが実現されています。

---

## 4. まとめと今後の展望

本研究では、3つの主要な課題に対し、プロンプトエンジニアリングによる解決策を提案・実装した。これにより、AI対話システムは、より現実的で、学習効果が高く、客観的な評価が可能なものへと進化した。

今後の展望としては、以下の点が挙げられる。
*   実際の日本語学習者を対象としたユーザーテストを実施し、改善されたシステムの教育的効果を定量的に測定する。
*   抽出された課題リストに基づき、特定の文法項目に特化した練習ミニゲームを動的に生成する機能の追加。

ご清聴ありがとうございました。何かご質問はございますでしょうか。
